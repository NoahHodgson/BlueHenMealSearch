<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Blue Hen Meal Search</title>
  <meta name="description" content="">
  <meta name="author" content="Noah Hodgson">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS and JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
  <link href="//db.onlinewebfonts.com/c/a1caa95569aad7c1dd438b6b57c41c3d?family=Greycliff+CF+Extra+Bold"
    rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>


  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/public/images/hen-clipart-blue-hen-3.png">
  <!--Style
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <style>
    body {
      background: conic-gradient(from 75deg at bottom right, cyan, #00539F);
    }

    h1 {
      font-family: "Greycliff CF Extra Bold";
      color: #FFD100;
    }

    h3 {
      color: white
    }

    h4 {
      font-family: Garmond;
      color: yellow;
    }

    label {
      font-size: large;
      color: white;
    }

    table,
    td {
      color: white;
      width: 75%;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>

<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
		<section class="search">
		<div class="row">
			<div class="col">
				<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #004aad;">
					<div class="container-fluid">
					<a class="navbar-brand mx-auto" href="index.html">
						<img src="/public/images/BHMS_Banner.png" alt="Blue Hen Meal Search">
					</a>
					</div>
				</nav>
			</div>
		</div>
		<br />
		<div class="row">
			<div class="col">
				<div class="input-group mb-3" style="justify-content: center;">
					<label for="str">
					<h3>Search...</h3>
					</label>
					<input class="form-control" type="text" id="str" name="str_name" style="max-width: 20%;"
					oninput="buildTable();">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col">
				<div class="dropdown">
					<button class="btn btn-warning dropdown-toggle" type="button" id="dropdownMenuButton1"
					data-bs-toggle="dropdown" aria-expanded="false" style="color: white;">
					Select time of day
					</button>
					<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" style="color: white;">
					<li><p class="dropdown-item" onclick="grabBreakfast()">Breakfast</p></li>
					<li><p class="dropdown-item" onclick="grabLunch()">Lunch</p></li>
					<li><p class="dropdown-item" onclick="grabDinner()">Dinner</p></li>
					</ul>
				</div>
			</div>
			<div class="col">
				<div class="dropdown">

					<button class="btn btn-primary dropdown-toggle" type="button" id="dropdownHallButton" data-bs-toggle="dropdown" aria-expanded="false">
						Filter by dining hall
					</button>
					<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2" style="color: white;">
						<li><a href="#" onclick="filterDiningHall('Russell')">Russell</a></li>
						<li><a href="#" onclick="filterDiningHall('Caesar Rodney')">Caesar Rodney</a></li>
						<li><a href="#" onclick="filterDiningHall('Pencader')">Pencader</a></li>
					</ul>
				</div>
			</div>
			<div class="col">
				<div class="dropdown">

					<button class="btn btn-primary dropdown-toggle" type="button" id="dropdownHallButton" data-bs-toggle="dropdown" aria-expanded="false">
						Common meal filter
					</button>
					<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2" style="color: white;">
						<li><a href="#" onclick="filterDiningHall('chicken')">Chicken</a></li>
						<li><a href="#" onclick="filterDiningHall('beef')">Beef</a></li>
						<li><a href="#" onclick="filterDiningHall('salad')">Salad</a></li>
					</ul>
				</div>
			</div>
		</div>
		</section>
  </div>

  <div class="container">
    <section class="pre-results">
      <h3 id="Results" style="text-align: center; padding-top: 10px;">Results:</h3>
      <table>
        <tr>
          <th>
            <h4 style="text-decoration: underline;">Item</h4>
          </th>
          <th>
            <h4 style="text-decoration: underline;">Dining Hall</h4>
          </th>
        </tr>
        <tbody id="meal table">

        </tbody>
      </table>
    </section>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js">
  </script>
  <script>
    //Make connection
    var socket = io.connect('bluehenmealsearch.com');

  </script>


  <script>
    var d = new Date();
    var hour = d.getHours();
    var b_meal_array = [];
    var l_meal_array = [];
    var d_meal_array = [];
    var meal_array;
    
      socket.on("b_meals", function (mealList) {
        console.log(mealList);
        b_meal_array = mealList;
      });
    
      socket.on("l_meals", function (mealList) {
        console.log(mealList);
        l_meal_array = mealList;
      });

      socket.on("d_meals", function (mealList) {
        console.log(mealList);
        d_meal_array = mealList;
      });

    socket.emit("requestMeals", "");

    //building the table depending on the time of day
    if(hour<11){
      grabBreakfast()
    }
    else if(hour>11 && hour<2){
      grabLunch()
    }
    else{
      grabDinner()
    }

	function filterCommonMeal(filter){

		meal_array = meal_array
		.filter(e => e.item.toLowerCase().includes(filter.toLowerCase()))
		.map(e => 
		`<tr data-id=${meal.item}>
			<td>${meal.item}</td>
			<td>Pencader</td>
		  </tr>`
		).join('');
		buildTable();

	}

	function filterDiningHall(hall){

		meal_array = meal_array
		.filter(e => e.url.includes(hall))
		.map(e => 
		`<tr data-id=${meal.item}>
			<td>${meal.item}</td>
			<td>Pencader</td>
		  </tr>`
		)
		.join('');
		buildTable();

	}

    //changes time of day
    function grabBreakfast(){
      document.getElementById("Results").innerHTML = "Breakfast Results";
      meal_array = b_meal_array;
      buildTable();
    }

    function grabLunch(){
      document.getElementById("Results").innerHTML = "Lunch Results";
      meal_array = l_meal_array;
      buildTable();
    }

    function grabDinner(){
      document.getElementById("Results").innerHTML = "Dinner Results";
      meal_array = d_meal_array;
      buildTable();
    }


    //build the table in Javascript
    function buildTable() {
      var meal_table = document.getElementById('meal table')
      var search = document.getElementById('str').value
      var table = "";
      var row = ""
      const matched = meal_array.filter(meal => meal.item.toLowerCase().includes(search.toLowerCase()));
      matched.forEach((meal) => {
        if (meal.url.includes("Pencader")) {
          row = `<tr data-id=${meal.item}>
                    <td>${meal.item}</td>
                    <td>Pencader</td>
                  </tr>`
          table += row
        }
        if (meal.url.includes("Russell")) {
          row = `<tr data-id=${meal.item}>
                    <td>${meal.item}</td>
                    <td>Russell</td>
                  </tr>`
          table += row
        }
        if (meal.url.includes("Caesar")) {
          row = `<tr data-id=${meal.item}>
                    <td>${meal.item}</td>
                    <td>Caesar Rodney</td>
                  </tr>`
          table += row
        }
      })
      meal_table.innerHTML = table;
    }


    function searchTable() {}
  </script>
  <!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>

</html>